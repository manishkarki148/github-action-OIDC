# GitHub action to demonstrate connecting to AWS using OIDC
on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Allows manual triggering

# Permission can be added at job level or workflow level    
permissions:
      id-token: write   # This is required for requesting the JWT
      contents: read    # This is required for actions/checkout
jobs:
  AssumeRoleAndCallIdentity:
    runs-on: ubuntu-latest
    steps:
      - name: configure aws credentials
        uses: aws-actions/configure-aws-credentials@v1.7.0
        with:
          role-to-assume: "arn:aws:iam::823644459118:role/MK-Github-OIDC" #change to reflect your IAM roleâ€™s ARN
          role-session-name: GitHub_to_AWS_via_FederatedOIDC
          aws-region: 'us-east-1'
      # to check Github action can get temporary credentials from STS
      - name: Sts GetCallerIdentity
        run: |
          aws sts get-caller-identity
      # To test Github action can access AWS
      - name: SGet S3 List
        run: |
          aws s3 ls
